
Arto's "staging for groupreport"-file
=================================================

```{r, echo=FALSE, results='hide'}
# sourcing:
# setwd("~/atlinks/dami-qame/dami_qame_2")
source('init1.R')
sourceCpp('arto/arto_implementation.cpp')
source('arto/arto_implementation.R')

# reading the data in:

courses.tr.old <- read.transactions('../dami_qame_1/course-text.txt', rm.duplicates=TRUE)
courses.tr <- read.transactions('courses_num.txt', rm.duplicates=TRUE)
courses.tidlists <- as(courses.tr, "tidLists")
courses.tidlists.aslist <- as(courses.tidlists, "list")
ReadInData()
lab <- convert.item.ids.to.names(itemLabels(courses.tr), item.id.to.course.name)

# parameters:
minsup <- 0.08 # 0.08 yields also non-closed frequent itemsets
minconfidence <- 0.8 # default in library
```

Algorithm related findings
--------------------------

### Frequent, closed and maximal itemsets and 1-rules
In the new dataset we observe that almost all of the frequent itemsets are also closed itemsets. Threshold has to be set to 0.08 to get at least some non-closed frequent itemsets. Even setting the threshold to 0.04 does not yield many non-closed itemsets, as we can see from the plot below (note that in the plot the rules include only rules that have consequents of size 1). 

The old dataset on comparison had much more non-closed itemsets as we can see from the plots. We thought that this could be related to the fact that old datasets density, 0.130863, is much bigger than the new dataset's density, 0.02010921. 
```{r, fig.height=12, echo=FALSE}
par(mfrow=c(2,2))
bm <- myget.allbm(courses.tr.old, 0.20, minconfidence)
myplot.fcmr(bm, mycolors, " OLD-DATASET (support=0.20)")
bm <- myget.allbm(courses.tr, 0.08, minconfidence)
myplot.fcmr(bm, mycolors, " NEW-DATASET (support=0.08)")
bm <- myget.allbm(courses.tr.old, 0.10, minconfidence)
myplot.fcmr(bm, mycolors, "OLD-DATASET (support=0.10)")
bm <- myget.allbm(courses.tr, 0.04, minconfidence)
myplot.fcmr(bm, mycolors, "NEW-DATASET (support=0.04)")
par(mfrow=c(1,1))
```


Substance data findings
--------------------------

### Most frequent courses
These will be interesting to compare later how much of the most interesting rules are based on itemfrequency (or lack of it). 
```{r, echo=FALSE}
temp <- courses.tr
itemLabels(temp) <- lab
itemFrequencyPlot(temp, topN=20, cex.names=0.75)
```


### Non-closed frequent itemsets and rule-confidence=1 relation
With support threshold=0.08 we get 6 itemsets that are not closed frequent. These itemsets are exactly the rule antecedents (left hand sides, LHS) of the only 1-consequent-rules that have confidence of 1 as we can see from output below. This means unioning these LHS with the rule consequent (right hand sides, RHS), item 80 (data_structures) in this case, we get itemsets whose supports are exactly the same as LHS alone. Therefore these LHS+RHS union itemsets are closed itemsets that close over their respective LHS-part (which are not closed themselves).

Also, Items 131 (introduction_to_the_use_of_computers), 194 (data_structures_project) and 83 (introduction_to_programming) appear in all of those 6 itemsets. But a rule {131,194,83} => {80} has a confidence of 0.9973118. This means that the itemset {131,194,83} have slightly higher support than the combined itemset {131,194,83,80}. Also, by knowing that {131,194,83} is not a closed itemset, we could immediately say that all of it's supersets must have lower support than it.
```{r}
bm <- myget.allbm(courses.tr, 0.08, minconfidence)
inspect(head(mynamify(sort(bm$rules, by="confidence"), lab), n=1))
as(setdiff(bm$fisets, bm$closed), "data.frame")
as(head(sort(bm$rules, by="confidence"), n=30), "data.frame")
```


### Interestigness measures for itemsets comparison
```{r}


# "allConfidence" (see, Omiencinski, 2003) is defined on itemsets as the minimum confidence of all possible rule generated from the itemset. [arules vignette]

fisets <- bm$fisets
temp <- interestMeasure(fisets, c("allConfidence"), courses.tr)
quality(fisets) <- cbind(quality(fisets), allConfidence=temp)
temp <- items(fisets); itemLabels(temp) <- lab; items(fisets) <- temp
q <- quality(fisets)
ex <- q[, "allConfidence"] == 1
ord <- order(q[!ex, "allConfidence"], decreasing=TRUE)
top.allConfidence  <- head(fisets[!ex,][ord])
# inspect(head(sort(fisets, by="allConfidence"), n=35))
# as(topim$allConfidence, "data.frame")
inspect(top.allConfidence)

# are these two somehow related?

topim <- list()
topim$lift  <- head(sort(bm$rules, by="lift"), n=8)
as(mynamify(topim$lift, lab), "data.frame")
```


### Big Matrix View of the whole dataset (scroll down)
```{r, bigmatrix, fig.height=180}
image(courses.tr[order(size(courses.tr), decreasing=T),order(itemFrequency(courses.tr), decreasing=T)])
```


Reproducible Research
----------------------
```{r, results='asis'}
# report build command: # source('init1.R'); source('init2.R'); build.report(c(5));
cat(c('```r', readLines('init1.R'), '```'), sep="\n")
```
